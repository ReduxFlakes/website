<!DOCTYPE html>
<html lang="{{ meta.lang }}">
  {% include "head.njk" -%}
  <body>
    <a href="#main-content" class="acs-skip">Skip to main content</a>
    {% include "toolbar.njk" %}
    {% include "nav.njk" %}
    {% include "header.njk" %}
    <main {% if (aside_enabled == true or aside_enabled == "true") and not is_home -%}class="has-aside"{% elif is_home %}class="has-aside home"{%- endif %}>
      {% include "breadcrumbs.njk" %}
      {% block base %}
        <article id="main-content" class="stack">
          {% if isInConstruction %}
            <p class="notice notice--warning" role="alert">
              <img src="/public/icons/farm-vlc.png" alt=""> This page is in construction, so expect broken features and/or missing content.</p>
          {% endif %}
          {{ content | safe }}
        </article>
      {% endblock base %}
      {%- if aside_enabled -%}
        <aside class="page-aside">
          {% getBundle "html",
          "aside" %}
        </aside>
      {% endif %}
    </main>
    {% include "footer.njk" %}
    {% block scripts %}{% endblock scripts %}
    <script>
      if (document.querySelector('details')) {
        const details = document.querySelectorAll('details');
        details.forEach((targetDetail) => {
          targetDetail.addEventListener("click", () => {
            details.forEach((detail) => {
              if (detail !== targetDetail) {
                detail.removeAttribute("open");
              }
            });
          });
        });
      }
    </script>
    {% if env.environment == "production" and is_home == true%}
      <script>
        /* based on https://maxpixels.moe/resources/nekoweb-stats */
        let domain = "reduxflakes.nekoweb.org";
        let user = "reduxflakes";

        (async () => {
          try {
            const nekoRequest = await fetch(`https://nekoweb.org/api/site/info/${domain}`,);
            const neoRequest = await fetch(`https://corsproxy.io/?https://neocities.org/api/info?sitename=${user}`)
            const nekoJson = await request.json();
            const neoJson = await request.json();

            const neoCreated = new Date(neoJson.created_at).toLocaleDateString();
            const neoUpdated = new Date(neoJson.last_updated).toLocaleDateString();

            const nekoCreated = new Date(nekoJson.created_at).toLocaleDateString();
            const nekoUpdated = new Date(nekoJson.updated_at).toLocaleDateString();

            if (document.getElementById("nekoCreated")) 
              document
                .getElementById("nekoCreated")
                .innerHTML = `Created ${nekoCreated}`;
            if (document.getElementById("nekoUpdated")) 
              document
                .getElementById("nekoUpdated")
                .innerHTML = `Updated ${nekoUpdated}`;
            if (document.getElementById("nekoVisitors")) 
              document
                .getElementById("nekoVisitors")
                .innerHTML = `Visits ${nekoJson.views}`;
            if (document.getElementById("nekoFollowers")) 
              document
                .getElementById("nekoFollowers")
                .innerHTML = `Followers ${nekoJson.followers}`;
            
            if (document.getElementById("neoCreated")) 
              document
                .getElementById("neoCreated")
                .innerHTML = `Created ${neoCreated}`;
            if (document.getElementById("nekoUpdated")) 
              document
                .getElementById("neoUpdated")
                .innerHTML = `Updated ${neoUpdated}`;
            if (document.getElementById("neoVisitors")) 
              document
                .getElementById("neoVisitors")
                .innerHTML = `Visits ${neoJson.info.views}`;
            }
          catch (error) {
            console.error(error);
          }
        })();
      </script>
    {% endif %}
  </body>
</html>